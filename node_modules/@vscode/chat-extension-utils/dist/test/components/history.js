"use strict";
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation and GitHub. All rights reserved.
 *--------------------------------------------------------------------------------------------*/
Object.defineProperty(exports, "__esModule", { value: true });
const prompt_tsx_1 = require("@vscode/prompt-tsx");
const chai_1 = require("chai");
const vscode_1 = require("vscode");
const history_1 = require("../../components/history");
const test_utils_1 = require("./test-utils");
suite('HistoryMessages', () => {
    const fakeHistory = [
        new vscode_1.ChatRequestTurn('User message 1'),
        new vscode_1.ChatResponseTurn([
            new vscode_1.ChatResponseMarkdownPart('Response 1'),
            new vscode_1.ChatResponseAnchorPart(vscode_1.Uri.parse('https://example.com'), 'Some link'),
        ]),
        new vscode_1.ChatRequestTurn('User message 2'),
        new vscode_1.ChatResponseTurn([
            new vscode_1.ChatResponseMarkdownPart(new vscode_1.MarkdownString('some *markdown*')),
            new vscode_1.ChatResponseAnchorPart(vscode_1.Uri.parse('https://example.org')),
        ]),
    ];
    test('renders history messages correctly', async () => {
        const p = await (0, test_utils_1.renderTestPrompt)({
            ctor: class extends prompt_tsx_1.PromptElement {
                render() {
                    return vscpp(history_1.HistoryMessages, { history: fakeHistory });
                }
            },
            props: {},
            budget: 1000,
        });
        const expectedText = [
            `${vscode_1.LanguageModelChatMessageRole.User}: User message 1`,
            `${vscode_1.LanguageModelChatMessageRole.Assistant}: Response 1[Some link](https://example.com/)`,
            `${vscode_1.LanguageModelChatMessageRole.User}: User message 2`,
            `${vscode_1.LanguageModelChatMessageRole.Assistant}: some *markdown*https://example.org/\n`,
        ];
        (0, chai_1.expect)((0, test_utils_1.getResultTextWithMessageTypes)(p)).to.equal(expectedText.join('\n'));
    });
});
